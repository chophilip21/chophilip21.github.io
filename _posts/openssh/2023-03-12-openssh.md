---
title: Setting up SSH Server with OpenSSH
date: 2023-03-12 11:58:47 +07:00
modified: 2023-03-12 16:49:47 +07:00
tags: [wsl2, openssh, ssh]
description: Improve productivity using SSH Server
image: "/openssh/openssh.gif"
---

The motive of this article, ironically started from a deep frustration towards WSL2. [Windows Subsystem for Linux (WSL)](https://learn.microsoft.com/en-us/windows/wsl/install) itself is a great tool that gives developers on Windows PC an easy access to Linux distributions like Debian without having to use traditional methods like VMs or dualboot setup. I own two computers currently, a Linux Desktop for Machine Learning purposes, and another Windows laptop that I use to study and work outside of home. Because the physical memory in the laptop is quite limited, I have been using WSL2 to set up my usual Linux programming environment.  

But the biggest problem is that **WSL2 is painfully slow**. Common operations such as tox build, pip install, or even simple git operations are at least couple order of magnitude slower. File I/O seems particularly lagging, most likely due to the way Windows emulates Linux file system on WSL. If your machine's computing power is lower, it becomes even more unbearable. This is a well known problem that has been addressed for years by the community, yet it has never been fully solved. I need to constantly build the project for my work, and the slowdown pretty drops the productivity to zero. So I concluded that the easiest and fastest solution to this problem, is to **set up my home Linux PC as an SSH sever**, and do all the computation there remotely.  

# Setting up SSH sever 

<figure>
<img src="/openssh/openssh.gif" alt="openssh">
<figcaption>OpenSSH encrypts all traffic to eliminate eavesdropping, connection hijacking, and other attacks.</figcaption>
</figure>

In this post, I will be using [OpenSSH](https://www.openssh.com/), widely used connectivity tool for remote login with the SSH protocol.  My PC will serve as a openssh-server, and my laptop will serve as the oppenssh-client. Assuming you have some sort of Linux distribution, refer to the code below:  

```bash
# update system packages.
$ sudo apt-get upgrade

# install both server and client.
$ sudo apt-get install openssh-client
$ sudo apt-get install openssh-server
```

[Starting and stopping](https://www.cyberciti.biz/faq/howto-start-stop-ssh-server/) OpenSSH server is dead simple.  

```bash
# start openssh server
$ sudo service ssh start

# stop openssh server
$ sudo systemctl stop ssh

# restart openssh server
$ sudo service ssh restart
```

Once your server is up and running, you should be able to see:

```bash

#check the output
$ ps -A | grep sshd

#similarily, you can run:
$ sudo service ssh status
```
You should see some terminal output, like **00:00:00 sshd**. If you don't, check your server is running properly again. The server is running, and it should be ready to accept client requests for connections. How does SSH server accept or reject connections? Of course by defining set of SSH keys that can connect.  

Try connecting to your own server.

```bash
$ ssh localhost 
```

If you get a permission error, most likely it means your key has not been added to set of **authorized keys**. Ensure you have already generated the SSH keys first (you should know the file name of the pub file), and then run below:

```bash
$ cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys
```

Now the localhost call should pass without any issues. And by adding other PC's SSH keys like above, any client will be able to connect to the server as long as the server is up and running. 

## Only allow ssh public key login

Even if you are only using for private purposes, you should follow some security protocols when configuring your server, such as:

- Disable root login in the server
- Disable password login from other user in the server. 

You can check from the config file that above two are disabled by default. 

```bash
$ vi /etc/ssh/sshd_config
```

You can also check that default port on the config file is set to **port:22**

# How to connect via SSH

We have successfully configured SSH server. Now if a remote client PC is trying to connect to server, there are couple information that it needs, like `user_name` and `ip address`. If you don't already know, run below from the server side.

```bash
#user name
whoami

#ip address
$ ip route
```
The IP address you see after `src` is the ip address you will be using for connection, so the full ssh command you will be running is something like:

```bash
$ ssh chophilip21@172.xx.xxx.xxx 
```









